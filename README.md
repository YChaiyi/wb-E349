# 简介

外包单，垃圾分类投放系统，毕设，如有部署和技术疑问可提交issue，小问题无偿帮助。所有第三方js库和css都应该无用，在近期版本中改为直接引用CDN。转载、部署、商用请声明本原作者-艺丞科技北京-刘海熠（仅用做学习、毕业设计、课业设计、大作业无需声明）

# 部署须知
MySQL8.0+，Python3.12，除Safari浏览器可以本地打开使用以外，其他浏览器使用需要先部署为网站，否则cookie将无法正常工作。

# 结构
``` markdown
wb_E340
├── backend
│   ├── app.py
│   ├── last.sql
│   ├── r.txt
│   └── uploads
│       ├── 10908fab-11ca-4fd6-ada0-f4ac02243881.jpg
│       ├── 923c8cb2-c477-447a-831d-6473657941c5.jpg
│       ├── be42c179-3573-4339-92e3-0929335b9158.jpg
│       └── ec2d2757-9cc4-48e0-b7ac-6f50d5d0df3a.jpg
└── frontend
    ├── admin
    │   ├── bootstrap.min.css
    │   ├── disposal_auditing.html
    │   ├── disposal_device_manage.html
    │   ├── disposal_type_manage.html
    │   ├── index.html
    │   ├── my.html
    │   └── user_manage.html
    ├── bootstrap.bundle.min
    ├── bootstrap.min.css
    ├── bootstrap.min.js
    ├── disposal.html
    ├── disposal_history.html
    ├── index.html
    ├── jquery-3.6.0.min.js
    ├── my.html
    └── popper.min.js

5 directories, 23 files
```

# 技术总结

## 后端

#### 1. 技术栈
- **框架**：Flask - 一个轻量级的Python Web框架，用于构建Web应用程序。
- **数据库**：MySQL - 用于存储用户信息、管理员信息、垃圾投放记录等数据。
- **JWT**：用于用户和管理员的身份验证和授权。
- **CORS**：通过Flask-CORS库实现跨域资源共享。
- **其他库**：uuid（生成唯一标识符）、jwt（生成和解码JWT令牌）、time（处理时间戳）、os（文件操作）、base64（处理图片编码）。

#### 2. 功能模块

##### 2.1 用户管理
- **注册** (`/register`): 接收教育ID、姓名和密码，验证教育ID和姓名匹配后生成用户UUID，并将用户信息存储在数据库中。
- **登录** (`/login`): 验证教育ID和密码，生成JWT令牌并更新数据库中的JWT令牌。
- **修改密码** (`/change_password`): 验证当前密码和新密码，更新数据库中的用户密码。
- **更新用户信息** (`/update_user_info`): 更新用户的学院、年级和班级信息。
- **获取用户信息** (`/user_info`): 返回用户的教育ID、姓名、积分、学院、班级和年级信息。
- **获取用户垃圾投放记录** (`/user_disposal_records`): 返回用户的所有垃圾投放记录。

##### 2.2 管理员管理
- **注册** (`/admin_register`): 接收教职工ID、姓名和密码，验证教职工ID和姓名匹配后将管理员信息存储在数据库中。
- **登录** (`/admin_login`): 验证教职工ID和密码，生成JWT令牌并更新数据库中的JWT令牌。
- **修改密码** (`/change_admin_password`): 验证当前密码和新密码，更新数据库中的管理员密码。
- **获取管理员信息** (`/admin_info`): 返回管理员的教职工ID和姓名。
- **获取所有用户垃圾投放记录** (`/admin_disposal_records`): 返回所有用户的垃圾投放记录。
- **获取所有用户信息** (`/get_users`): 返回所有用户的信息。
- **管理用户** (`/manage_user`): 管理员可以删除用户、更新用户信息以及更改用户密码。

##### 2.3 验证
- **验证token** (`/validate_token`): 验证用户或管理员的JWT令牌是否有效。

##### 2.4 垃圾投放记录管理
- **创建投放记录** (`/disposal_record`): 接收用户令牌、图片的base64编码、设备ID和垃圾类型，保存图片并将记录存储在数据库中。
- **更新用户积分** (`/update_points`): 更新用户积分并标记投放记录的积分状态。

##### 2.5 设备管理
- **获取设备列表** (`/get_devices`): 返回所有设备的列表。
- **管理设备** (`/manage_device`): 管理员可以添加、删除和更新设备信息。

##### 2.6 垃圾类型管理
- **获取垃圾类型列表** (`/get_disposal_types`): 返回所有垃圾类型的列表。
- **管理垃圾类型** (`/manage_disposal_type`): 管理员可以添加、删除和更新垃圾类型信息。

#### 3. 安全性
- **JWT**：用于用户和管理员的身份验证，确保只有合法用户和管理员才能访问受保护的资源。
- **密码存储**：目前密码是明文存储，建议使用哈希算法（如bcrypt）对密码进行加密存储。
- **跨域资源共享**：通过Flask-CORS库允许所有来源的跨域资源共享。

#### 4. 数据库设计
- **user_info**：存储用户的UUID、教育ID、姓名、密码、JWT令牌、积分、学院、年级和班级信息。
- **admin_user**：存储管理员的教职工ID、姓名、密码和JWT令牌。
- **user_disposal_records**：存储用户的垃圾投放记录，包括用户UUID、图片路径、设备ID、垃圾类型和创建时间。
- **devices**：存储设备信息，包括设备ID和描述。
- **disposal_type**：存储垃圾类型信息，包括类型ID和描述。

#### 5. 文件管理
- **图片存储**：投放记录中的图片以base64编码形式上传，解码后存储在服务器的指定目录中。

## 前端

#### 1. 技术栈
- **HTML**：用于构建页面结构。
- **CSS**：通过Bootstrap和自定义样式实现页面布局和样式。
- **JavaScript**：用于处理页面交互和与后端的通信。
- **Bootstrap**：用于快速构建响应式和现代化的Web页面。
- **Ajax**：通过Fetch API和jQuery实现异步请求。

#### 2. 功能模块

##### 2.1 登录注册模块
- **登录** (`/login`): 用户通过输入教育ID和密码进行登录。前端会发送登录请求到后端，获取JWT令牌并存储在cookie中。
- **注册** (`/register`): 用户通过输入教育ID、姓名和密码进行注册。前端会发送注册请求到后端，注册成功后提示用户使用教育ID和密码登录。

##### 2.2 垃圾投放模块
- **投放垃圾** (`/disposal`): 用户可以上传垃圾图片，选择垃圾类型和投放设备进行垃圾投放。前端会将数据发送到后端进行处理，并显示投放结果。
- **投放记录** (`/disposal_history`): 用户可以查看自己的垃圾投放记录，包括投放时间、垃圾类型和投放设备。前端通过获取用户的投放记录并动态生成记录卡片显示在页面上。

##### 2.3 个人中心模块
- **个人信息** (`/my`): 用户可以查看和编辑个人信息，包括姓名、教育ID、积分、学院、年级和班级。用户还可以修改密码。
- **修改密码** (`/change_password`): 用户可以通过输入当前密码和新密码来修改密码。前端会将数据发送到后端进行处理。

##### 2.4 管理端模块
- **投放记录管理** (`/admin/disposal_auditing`): 管理员可以查看所有用户的投放记录，并对投放记录进行加分操作。
- **投放设备管理** (`/admin/disposal_device_manage`): 管理员可以新增、修改和删除投放设备。
- **投放类别管理** (`/admin/disposal_type_manage`): 管理员可以新增、修改和删除投放类别。
- **用户管理** (`/admin/user_manage`): 管理员可以查看所有用户信息，并对用户信息进行修改和删除操作。

# 外链

这里是[艺丞科技（北京）有限公司的官网](https://yicheng.bj.cn)。


# 交流

欢迎添加我的微信haiyi-three(商单可接，学校设计单可接。个人全栈开发，App、API、网站、小程序、算法均可做。
